# RAG Agent

–õ–æ–∫–∞–ª—å–Ω—ã–π AI-–∞–≥–µ–Ω—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Ollama, ChromaDB –∏ sentence-transformers –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ RAG (Retrieval-Augmented Generation).

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤**: PDF, DOCX, Excel (xlsx/xls)
- **XWiki –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ò–º–ø–æ—Ä—Ç —Å—Ç—Ä–∞–Ω–∏—Ü –∏–∑ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π wiki
- **–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**: ChromaDB –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **RAG**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UI —Å –≤–∫–ª–∞–¥–∫–∞–º–∏
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**: –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: TTL –∫—ç—à –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **Multilingual**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama

**macOS:**
```bash
brew install ollama
ollama serve &
ollama pull llama3.2:1b
```

**Linux:**
```bash
curl -fsSL https://ollama.com/install.sh | sh
ollama serve &
ollama pull llama3.2:1b
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
git clone <YOUR_REPO_URL>
cd rag-agent

# –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞
cp .env.example .env
```

### 3. –ó–∞–ø—É—Å–∫

```bash
# –ò—Å–ø–æ–ª—å–∑—É—è —Å–∫—Ä–∏–ø—Ç
./start.sh

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
python main.py
```

–û—Ç–∫—Ä–æ–π—Ç–µ **http://localhost:8000** –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

## üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

#### –í–∫–ª–∞–¥–∫–∞ "XWiki"
1. –í–≤–µ–¥–∏—Ç–µ URL –≤–∞—à–µ–≥–æ XWiki —Å–µ—Ä–≤–µ—Ä–∞
2. –£–∫–∞–∂–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"
4. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

#### –í–∫–ª–∞–¥–∫–∞ "–î–æ–∫—É–º–µ–Ω—Ç—ã"
1. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã (PDF, DOCX, Excel) –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏—Ö
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### –í–∫–ª–∞–¥–∫–∞ "–ß–∞—Ç"
1. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å
2. –ü–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
3. –û—á–∏—Å—Ç–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

#### –í–∫–ª–∞–¥–∫–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
- –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (llama3.2:1b / 3b)
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (temperature, tokens, context)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### API

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
curl -X POST "http://localhost:8000/upload" -F "file=@document.pdf"

# –ó–∞–ø—Ä–æ—Å
curl -X POST "http://localhost:8000/query" \
  -H "Content-Type: application/json" \
  -d '{"question": "–í–∞—à –≤–æ–ø—Ä–æ—Å"}'

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
curl http://localhost:8000/stats

# Health check
curl http://localhost:8000/health

# XWiki –∏–º–ø–æ—Ä—Ç
curl -X POST "http://localhost:8000/xwiki/import" \
  -H "Content-Type: application/json" \
  -d '{
    "base_url": "http://localhost:8080/xwiki",
    "wiki": "xwiki",
    "space": "Main"
  }'
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
rag-agent/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ server.py              # FastAPI —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ rag_engine.py          # RAG –¥–≤–∏–∂–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ vector_store.py        # ChromaDB
‚îÇ   ‚îú‚îÄ‚îÄ embeddings.py          # –≠–º–±–µ–¥–¥–∏–Ω–≥–∏
‚îÇ   ‚îú‚îÄ‚îÄ document_parser.py     # –ü–∞—Ä—Å–∏–Ω–≥ (PDF, DOCX, Excel)
‚îÇ   ‚îú‚îÄ‚îÄ xwiki_connector.py     # XWiki –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ settings_manager.py    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ cache_manager.py       # –ö—ç—à —Å TTL
‚îÇ   ‚îî‚îÄ‚îÄ file_utils.py          # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ index.html             # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îú‚îÄ‚îÄ app.js                 # JavaScript
‚îÇ   ‚îî‚îÄ‚îÄ style.css              # –°—Ç–∏–ª–∏
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ documents/             # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ chroma_db/             # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ settings.json          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ config.py                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ requirements.txt           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª .env

```bash
# Ollama
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama3.2:1b
OLLAMA_TIMEOUT=600

# –≠–º–±–µ–¥–¥–∏–Ω–≥–∏
EMBEDDING_MODEL=sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
CHUNK_SIZE=1000
CHUNK_OVERLAP=200
TOP_K_RESULTS=1

# API
API_HOST=0.0.0.0
API_PORT=8000
MAX_UPLOAD_SIZE=10485760

# –ö—ç—à
ENABLE_CACHE=true
CACHE_TTL=3600
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ë—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞:**
```bash
OLLAMA_MODEL=llama3.2:1b
TOP_K_RESULTS=1
```

**–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:**
```bash
OLLAMA_MODEL=llama3.2:3b
TOP_K_RESULTS=3
```

## üîß –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### Excel —Ñ–∞–π–ª—ã
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –ª–∏—Å—Ç—ã
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤
- –î–∞–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç

### XWiki
- –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (space, URL)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –ö–ª–∏–∫ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É ‚Üí –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–§—Ä–∞–≥–º–µ–Ω—Ç X –∏–∑ Y"
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Escape, –∫–ª–∏–∫ –≤–Ω–µ –æ–∫–Ω–∞, –∫–Ω–æ–ø–∫–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- TTL –∫—ç—à –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSON
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ (–¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
pip install -r requirements.txt
```

### –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π

```bash
# –í main.py —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ reload=True
uvicorn.run("api.server:app", reload=True)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞

```bash
# –ù–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
python -m py_compile api/server.py src/*.py
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[CONTRIBUTING.md](CONTRIBUTING.md)** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- **[PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md)** - –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **[REFACTORING_SUMMARY.md](REFACTORING_SUMMARY.md)** - –ò—Å—Ç–æ—Ä–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Ollama –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
ps aux | grep ollama
ollama serve &
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥–µ–ª—å `llama3.2:1b`
- –£–º–µ–Ω—å—à–∏—Ç–µ `TOP_K_RESULTS`
- –£–≤–µ–ª–∏—á—å—Ç–µ `OLLAMA_TIMEOUT`

### Excel –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä (–º–∞–∫—Å. 10MB)
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ (.xlsx –∏–ª–∏ .xls)

### XWiki –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL (–¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å `/xwiki`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ REST API

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–°–º. —Ñ–∞–π–ª [LICENSE](LICENSE)

## ü§ù –í–∫–ª–∞–¥

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è pull requests! –°–º. [CONTRIBUTING.md](CONTRIBUTING.md)
